# Generic single-database configuration using Alembic

Alembic allows an easy data migration with sqlalchemy. You can easily change your schema or restore data using this.
For more about alembic refer to: [Alembic Tutorial](https://alembic.sqlalchemy.org/en/latest/tutorial.html) and [Blog Post](https://medium.com/@kimberly.d.benton/alembic-migrations-1191d67f9538)

Files under `/migrations` and `alembic.ini` are auto-generated by alembic by running a `alembic init -t async migrations`. However, we need to modify `env.py` to connect the DB schema we defined in `schema.py` and set up the db url.

`env.py`: this script will be invoked when the alembic is running the migration. Database url and db schema are set in this script. DB schema is set through `target_metadata = Base.metadata` and DB url is set by setting `"sqlalchemy.url"`

## Dependencies

```Bash
pip install '.[migration]'
```

## Generates alembic migration scripts

This will create scripts under ./versions

```Bash
alembic revision --autogenerate -m "Baseline: create tables" # will autogenerate tables
```

More about `--autogenerate` option: [Alembic Documentation](https://alembic.sqlalchemy.org/en/latest/autogenerate.html)

## Apply migration

1. Online (apply it to database directly)

    ```Bash
    alembic upgrade head 
    ```

2. Offline (generate sql)

    ```Bash
    alembic upgrade head --sql
    ```
