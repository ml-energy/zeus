
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Deep learning energy measurement and optimization">
      
      
        <meta name="author" content="Zeus team">
      
      
        <link rel="canonical" href="https://ml.energy/zeus/reference/optimizer/power_limit/">
      
      
        <link rel="prev" href="../pipeline_frequency/server/scheduler/">
      
      
        <link rel="next" href="../../show_env/">
      
      
      <link rel="icon" href="../../../assets/img/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.19">
    
    
      
        <title>power_limit - Zeus Project</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../assets/css/custom.css">
    
      <link rel="stylesheet" href="../../../assets/css/color.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-T3W21TQ7FJ"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-T3W21TQ7FJ",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-T3W21TQ7FJ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="power_limit - Zeus Project" >
      
        <meta  property="og:description"  content="Deep learning energy measurement and optimization" >
      
        <meta  property="og:image"  content="https://ml.energy/zeus/assets/img/social/reference/optimizer/power_limit.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://ml.energy/zeus/reference/optimizer/power_limit/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="power_limit - Zeus Project" >
      
        <meta  name="twitter:description"  content="Deep learning energy measurement and optimization" >
      
        <meta  name="twitter:image"  content="https://ml.energy/zeus/assets/img/social/reference/optimizer/power_limit.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="zeus" data-md-color-accent="zeus">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zeus.optimizer.power_limit" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
              </button>
            
            
We're sharing updates via <a href="https://buttondown.com/ml-energy">The ML.ENERGY Newsletter</a>!
&middot;
Join the Zeus
<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6 15a2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2h2v2m1 0a2 2 0 0 1 2-2 2 2 0 0 1 2 2v5a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-5m2-8a2 2 0 0 1-2-2 2 2 0 0 1 2-2 2 2 0 0 1 2 2v2H9m0 1a2 2 0 0 1 2 2 2 2 0 0 1-2 2H4a2 2 0 0 1-2-2 2 2 0 0 1 2-2h5m8 2a2 2 0 0 1 2-2 2 2 0 0 1 2 2 2 2 0 0 1-2 2h-2v-2m-1 0a2 2 0 0 1-2 2 2 2 0 0 1-2-2V5a2 2 0 0 1 2-2 2 2 0 0 1 2 2v5m-2 8a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2v-2h2m0-1a2 2 0 0 1-2-2 2 2 0 0 1 2-2h5a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-5Z"></path></svg></span>
<a href="https://join.slack.com/t/zeus-ml/shared_invite/zt-36fl1m7qa-Ihky6FbfxLtobx40hMj3VA">Slack workspace</a>
to reach out to us.

          </div>
          
            <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Zeus Project" class="md-header__button md-logo" aria-label="Zeus Project" data-md-component="logo">
      
  <img src="../../../assets/img/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zeus Project
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              power_limit
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="zeus" data-md-color-accent="zeus"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ml-energy/zeus" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ml-energy/zeus
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Zeus

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../getting_started/" class="md-tabs__link">
        
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../measure/" class="md-tabs__link">
        
  
    
  
  Measuring Energy

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../optimize/" class="md-tabs__link">
        
  
    
  
  Optimizing Energy

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../research_overview/" class="md-tabs__link">
        
  
    
  
  Research Overview

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  Source Code Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Zeus Project" class="md-nav__button md-logo" aria-label="Zeus Project" data-md-component="logo">
      
  <img src="../../../assets/img/logo.svg" alt="logo">

    </a>
    Zeus Project
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ml-energy/zeus" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    ml-energy/zeus
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zeus
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../measure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Measuring Energy
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../optimize/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Optimizing Energy
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Optimizing Energy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../optimize/power_limit_optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Power Limit Optimizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../optimize/batch_size_optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Batch Size Optimizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../optimize/pipeline_frequency_optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pipeline Frequency Optimizer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../research_overview/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Research Overview
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Research Overview
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research_overview/zeus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Zeus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../research_overview/perseus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perseus
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Source Code Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Source Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Source Code Reference
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Source Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../_legacy/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    _legacy
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_1" id="__nav_6_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1">
            <span class="md-nav__icon md-icon"></span>
            _legacy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_legacy/job/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    job
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../_legacy/policy/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    policy
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_1_2" id="__nav_6_1_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            policy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_legacy/policy/interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_legacy/policy/mab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_legacy/policy/optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    optimizer
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../_legacy/simulate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    simulate
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../callback/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    callback
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../device/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    device
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_3" id="__nav_6_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3">
            <span class="md-nav__icon md-icon"></span>
            device
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../device/cpu/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    cpu
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_3_2" id="__nav_6_1_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            cpu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/cpu/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/cpu/rapl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    rapl
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/exception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../device/gpu/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    gpu
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_3_4" id="__nav_6_1_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3_4">
            <span class="md-nav__icon md-icon"></span>
            gpu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/gpu/amd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    amd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/gpu/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/gpu/nvidia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nvidia
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_3_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../device/soc/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    soc
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_3_5" id="__nav_6_1_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_3_5">
            <span class="md-nav__icon md-icon"></span>
            soc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/soc/apple/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    apple
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/soc/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../device/soc/jetson/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jetson
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../exception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exception
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../metric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    metric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../monitor/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    monitor
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_6" id="__nav_6_1_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_6">
            <span class="md-nav__icon md-icon"></span>
            monitor
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitor/carbon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    carbon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitor/energy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    energy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitor/power/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    power
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitor/power_streaming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    power_streaming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitor/price/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    price
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../monitor/temperature/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    temperature
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    optimizer
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7" id="__nav_6_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6_1_7">
            <span class="md-nav__icon md-icon"></span>
            optimizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../batch_size/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    batch_size
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_1" id="__nav_6_1_7_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_1">
            <span class="md-nav__icon md-icon"></span>
            batch_size
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/client/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    client
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exceptions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_1_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../batch_size/server/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    server
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_1_4" id="__nav_6_1_7_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_7_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_1_4">
            <span class="md-nav__icon md-icon"></span>
            server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_1_4_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../batch_size/server/batch_size_state/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    batch_size_state
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_1_4_1" id="__nav_6_1_7_1_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_6_1_7_1_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_1_4_1">
            <span class="md-nav__icon md-icon"></span>
            batch_size_state
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/batch_size_state/commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/batch_size_state/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/batch_size_state/repository/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    repository
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_1_4_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../batch_size/server/database/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    database
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_1_4_3" id="__nav_6_1_7_1_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_6_1_7_1_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_1_4_3">
            <span class="md-nav__icon md-icon"></span>
            database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/database/db_connection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    db_connection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/database/repository/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/database/schema/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    schema
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exceptions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/explorer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    explorer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_1_4_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../batch_size/server/job/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    job
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_1_4_6" id="__nav_6_1_7_1_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_6_1_7_1_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_1_4_6">
            <span class="md-nav__icon md-icon"></span>
            job
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/job/commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/job/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/job/repository/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    repository
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/mab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    optimizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/router/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    router
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_1_4_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../batch_size/server/services/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    services
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_1_4_10" id="__nav_6_1_7_1_4_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_6_1_7_1_4_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_1_4_10">
            <span class="md-nav__icon md-icon"></span>
            services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/services/commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../batch_size/server/services/service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    service
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../pipeline_frequency/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    pipeline_frequency
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_2" id="__nav_6_1_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_6_1_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_2">
            <span class="md-nav__icon md-icon"></span>
            pipeline_frequency
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline_frequency/common/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    common
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline_frequency/frequency_controller/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    frequency_controller
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline_frequency/optimizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    optimizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_7_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../pipeline_frequency/server/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    server
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_7_2_4" id="__nav_6_1_7_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_6_1_7_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_7_2_4">
            <span class="md-nav__icon md-icon"></span>
            server
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline_frequency/server/job_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    job_manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline_frequency/server/router/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    router
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline_frequency/server/scheduler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    scheduler
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    power_limit
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    power_limit
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit" class="md-nav__link">
    <span class="md-ellipsis">
      power_limit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="power_limit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.OptimumSelector" class="md-nav__link">
    <span class="md-ellipsis">
      OptimumSelector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OptimumSelector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.OptimumSelector.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Energy" class="md-nav__link">
    <span class="md-ellipsis">
      Energy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Energy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Energy.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Time" class="md-nav__link">
    <span class="md-ellipsis">
      Time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Time.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.ZeusCost" class="md-nav__link">
    <span class="md-ellipsis">
      ZeusCost
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ZeusCost">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.ZeusCost.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.ZeusCost.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.MaxSlowdownConstraint" class="md-nav__link">
    <span class="md-ellipsis">
      MaxSlowdownConstraint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MaxSlowdownConstraint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.MaxSlowdownConstraint.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.MaxSlowdownConstraint.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Ready" class="md-nav__link">
    <span class="md-ellipsis">
      Ready
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Warmup" class="md-nav__link">
    <span class="md-ellipsis">
      Warmup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Profiling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Done" class="md-nav__link">
    <span class="md-ellipsis">
      Done
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.PowerLimitMeasurement" class="md-nav__link">
    <span class="md-ellipsis">
      PowerLimitMeasurement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit._PowerLimitMeasurementList" class="md-nav__link">
    <span class="md-ellipsis">
      _PowerLimitMeasurementList
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer" class="md-nav__link">
    <span class="md-ellipsis">
      GlobalPowerLimitOptimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GlobalPowerLimitOptimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer--usage-with-distributed-data-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Usage with distributed data parallelism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      on_epoch_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.on_step_begin" class="md-nav__link">
    <span class="md-ellipsis">
      on_step_begin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._set_power_limit" class="md-nav__link">
    <span class="md-ellipsis">
      _set_power_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._compute_optimal_power_limit" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_optimal_power_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._save_profile" class="md-nav__link">
    <span class="md-ellipsis">
      _save_profile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer" class="md-nav__link">
    <span class="md-ellipsis">
      HFGlobalPowerLimitOptimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HFGlobalPowerLimitOptimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      on_epoch_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.on_step_begin" class="md-nav__link">
    <span class="md-ellipsis">
      on_step_begin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../show_env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    show_env
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../utils/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    utils
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6_1_9" id="__nav_6_1_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1_9">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/async_utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    async_utils
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/env/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    env
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/framework/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    framework
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/lat_lon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lat_lon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/logging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    logging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/lr_scaler/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lr_scaler
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/metric/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    metric
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/multiprocessing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    multiprocessing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/pydantic_v1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pydantic_v1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    testing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/zeusd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zeusd
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit" class="md-nav__link">
    <span class="md-ellipsis">
      power_limit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="power_limit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.OptimumSelector" class="md-nav__link">
    <span class="md-ellipsis">
      OptimumSelector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OptimumSelector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.OptimumSelector.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Energy" class="md-nav__link">
    <span class="md-ellipsis">
      Energy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Energy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Energy.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Time" class="md-nav__link">
    <span class="md-ellipsis">
      Time
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Time">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Time.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.ZeusCost" class="md-nav__link">
    <span class="md-ellipsis">
      ZeusCost
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ZeusCost">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.ZeusCost.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.ZeusCost.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.MaxSlowdownConstraint" class="md-nav__link">
    <span class="md-ellipsis">
      MaxSlowdownConstraint
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MaxSlowdownConstraint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.MaxSlowdownConstraint.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.MaxSlowdownConstraint.select" class="md-nav__link">
    <span class="md-ellipsis">
      select
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Ready" class="md-nav__link">
    <span class="md-ellipsis">
      Ready
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Warmup" class="md-nav__link">
    <span class="md-ellipsis">
      Warmup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Profiling" class="md-nav__link">
    <span class="md-ellipsis">
      Profiling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.Done" class="md-nav__link">
    <span class="md-ellipsis">
      Done
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.PowerLimitMeasurement" class="md-nav__link">
    <span class="md-ellipsis">
      PowerLimitMeasurement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit._PowerLimitMeasurementList" class="md-nav__link">
    <span class="md-ellipsis">
      _PowerLimitMeasurementList
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer" class="md-nav__link">
    <span class="md-ellipsis">
      GlobalPowerLimitOptimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GlobalPowerLimitOptimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer--usage-with-distributed-data-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Usage with distributed data parallelism
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      on_epoch_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.on_step_begin" class="md-nav__link">
    <span class="md-ellipsis">
      on_step_begin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._set_power_limit" class="md-nav__link">
    <span class="md-ellipsis">
      _set_power_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._compute_optimal_power_limit" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_optimal_power_limit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._save_profile" class="md-nav__link">
    <span class="md-ellipsis">
      _save_profile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer" class="md-nav__link">
    <span class="md-ellipsis">
      HFGlobalPowerLimitOptimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HFGlobalPowerLimitOptimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.on_epoch_end" class="md-nav__link">
    <span class="md-ellipsis">
      on_epoch_end
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.on_step_begin" class="md-nav__link">
    <span class="md-ellipsis">
      on_step_begin
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>power_limit</h1>

<div class="doc doc-object doc-module">



<h2 id="zeus.optimizer.power_limit" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">zeus.optimizer.power_limit</span>


</h2>

    <div class="doc doc-contents first">

        <p>Optimizers that select the optimum power limit.</p>
<p>This module contains the following pieces:</p>
<ul>
<li><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;GlobalPowerLimitOptimizer&lt;/span&gt;" href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer"><code>GlobalPowerLimitOptimizer</code></a>
  is the main class that implements the state machine
  and the logic for profiling power limits and selecting
  the optimum power limit.</li>
<li><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;PowerLimitMeasurement&lt;/span&gt;" href="#zeus.optimizer.power_limit.PowerLimitMeasurement"><code>PowerLimitMeasurement</code></a> and various
  state classes are helpers that support the state machine.</li>
<li><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;OptimumSelector&lt;/span&gt;" href="#zeus.optimizer.power_limit.OptimumSelector"><code>OptimumSelector</code></a>
  is an abstract base class for selecting the optimum power limit
  from a list of power limit profiling results. There are concrete classes
  that implement different selection strategies, like
  <a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Energy&lt;/span&gt;" href="#zeus.optimizer.power_limit.Energy">minimizing energy</a>,
  <a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Time&lt;/span&gt;" href="#zeus.optimizer.power_limit.Time">minimizing time</a>,
  <a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;ZeusCost&lt;/span&gt;" href="#zeus.optimizer.power_limit.ZeusCost">minimizing the Zeus time-energy cost</a>,
  or <a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;MaxSlowdownConstraint&lt;/span&gt;" href="#zeus.optimizer.power_limit.MaxSlowdownConstraint">selecting the lowest power limit that meets the given maximum training time slowdown factor</a>.</li>
<li><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;HFGlobalPowerLimitOptimizer&lt;/span&gt;" href="#zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer"><code>HFGlobalPowerLimitOptimizer</code></a>
  is a wrapper for the Hugging Face <code>TrainerCallback</code> class that uses <code>GlobalPowerLimitOptimizer</code>.</li>
</ul>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.OptimumSelector" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">OptimumSelector</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base class for optimum power limit selectors.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">OptimumSelector</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for optimum power limit selectors.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.OptimumSelector.select" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">select</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">select</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the optimal power limit (W) from measurements.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.Energy" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Energy</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;OptimumSelector&lt;/span&gt; (&lt;code&gt;zeus.optimizer.power_limit.OptimumSelector&lt;/code&gt;)" href="#zeus.optimizer.power_limit.OptimumSelector">OptimumSelector</a></code></p>


        <p>Selects the power limit that minimizes energy consumption.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Energy</span><span class="p">(</span><span class="n">OptimumSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Selects the power limit that minimizes energy consumption.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span><span class="o">.</span><span class="n">power_limit</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.Energy.select" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">select</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">select</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the optimal power limit (W) from measurements.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span><span class="o">.</span><span class="n">power_limit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.Time" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Time</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;OptimumSelector&lt;/span&gt; (&lt;code&gt;zeus.optimizer.power_limit.OptimumSelector&lt;/code&gt;)" href="#zeus.optimizer.power_limit.OptimumSelector">OptimumSelector</a></code></p>


        <p>Selects the power limit that minimizes training time.</p>
<p>This may not necessarily choose the maximum power limit, as time profiling
results can be slightly noisy. However, we believe that's actually better
because it means that training time is very similar among higher power limits,
but lower power limit will consume less power.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Time</span><span class="p">(</span><span class="n">OptimumSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Selects the power limit that minimizes training time.</span>

<span class="sd">    This may not necessarily choose the maximum power limit, as time profiling</span>
<span class="sd">    results can be slightly noisy. However, we believe that&#39;s actually better</span>
<span class="sd">    because it means that training time is very similar among higher power limits,</span>
<span class="sd">    but lower power limit will consume less power.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">power_limit</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.Time.select" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">select</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">select</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the optimal power limit (W) from measurements.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">measurements</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">power_limit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.ZeusCost" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ZeusCost</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;OptimumSelector&lt;/span&gt; (&lt;code&gt;zeus.optimizer.power_limit.OptimumSelector&lt;/code&gt;)" href="#zeus.optimizer.power_limit.OptimumSelector">OptimumSelector</a></code></p>


        <p>Selects the power limit that minimizes a linear Zeus time-energy cost function.</p>
<p>Cost function is <span class="arithmatex">\(\eta \cdot \text{Energy} + (1 - \eta) \cdot \text{MaxPower} \cdot \text{Time}\)</span>.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ZeusCost</span><span class="p">(</span><span class="n">OptimumSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Selects the power limit that minimizes a linear Zeus time-energy cost function.</span>

<span class="sd">    Cost function is $\eta \cdot \text{Energy} + (1 - \eta) \cdot \text{MaxPower} \cdot \text{Time}$.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eta_knob</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">world_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize the selector.</span>

<span class="sd">        Args:</span>
<span class="sd">            eta_knob: The $0 \le \eta \le 1$ knob for the Zeus time-energy cost function.</span>
<span class="sd">            world_size: The number of GPUs in the training job. Defaults to 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">eta_knob</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">eta_knob</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;eta_knob must be between 0 and 1, inclusive both sides.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">world_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;world_size must be greater than or equal to 1.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">eta_knob</span> <span class="o">=</span> <span class="n">eta_knob</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">world_size</span> <span class="o">=</span> <span class="n">world_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
        <span class="n">max_power</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span> <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_size</span>
        <span class="n">zeus_cost_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span><span class="p">:</span> <span class="n">zeus_cost</span><span class="p">(</span>
                <span class="n">energy</span><span class="o">=</span><span class="n">measurement</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">measurement</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
                <span class="n">eta_knob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_knob</span><span class="p">,</span>
                <span class="n">max_power</span><span class="o">=</span><span class="n">max_power</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">zeus_cost_map</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">zeus_cost_map</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.ZeusCost.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">eta_knob</span><span class="p">,</span> <span class="n">world_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>eta_knob</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The <span class="arithmatex">\(0 \le \eta \le 1\)</span> knob for the Zeus time-energy cost function.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>world_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of GPUs in the training job. Defaults to 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eta_knob</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">world_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize the selector.</span>

<span class="sd">    Args:</span>
<span class="sd">        eta_knob: The $0 \le \eta \le 1$ knob for the Zeus time-energy cost function.</span>
<span class="sd">        world_size: The number of GPUs in the training job. Defaults to 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">eta_knob</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">eta_knob</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;eta_knob must be between 0 and 1, inclusive both sides.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">world_size</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;world_size must be greater than or equal to 1.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">eta_knob</span> <span class="o">=</span> <span class="n">eta_knob</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">world_size</span> <span class="o">=</span> <span class="n">world_size</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.ZeusCost.select" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">select</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">select</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the optimal power limit (W) from measurements.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
    <span class="n">max_power</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span> <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">world_size</span>
    <span class="n">zeus_cost_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span><span class="p">:</span> <span class="n">zeus_cost</span><span class="p">(</span>
            <span class="n">energy</span><span class="o">=</span><span class="n">measurement</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">measurement</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
            <span class="n">eta_knob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_knob</span><span class="p">,</span>
            <span class="n">max_power</span><span class="o">=</span><span class="n">max_power</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">zeus_cost_map</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">zeus_cost_map</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.MaxSlowdownConstraint" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MaxSlowdownConstraint</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;OptimumSelector&lt;/span&gt; (&lt;code&gt;zeus.optimizer.power_limit.OptimumSelector&lt;/code&gt;)" href="#zeus.optimizer.power_limit.OptimumSelector">OptimumSelector</a></code></p>


        <p>Selects the minumum power limit that does not slow down training by more than the given factor.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MaxSlowdownConstraint</span><span class="p">(</span><span class="n">OptimumSelector</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Selects the minumum power limit that does not slow down training by more than the given factor.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the selector.</span>

<span class="sd">        Args:</span>
<span class="sd">            factor: The maximum allowed slowdown factor. Greater than or equal to 1.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;max_slowdown_factor must be greater than or equal to 1.0. Got </span><span class="si">{</span><span class="n">factor</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
        <span class="n">feasible_power_limits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_power</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span> <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">)</span>
        <span class="n">shortest_time</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">time</span> <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span> <span class="k">if</span> <span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span> <span class="o">==</span> <span class="n">max_power</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">measurement</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">shortest_time</span><span class="p">:</span>
                <span class="n">feasible_power_limits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">feasible_power_limits</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.MaxSlowdownConstraint.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">factor</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>factor</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum allowed slowdown factor. Greater than or equal to 1.0.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the selector.</span>

<span class="sd">    Args:</span>
<span class="sd">        factor: The maximum allowed slowdown factor. Greater than or equal to 1.0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;max_slowdown_factor must be greater than or equal to 1.0. Got </span><span class="si">{</span><span class="n">factor</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.MaxSlowdownConstraint.select" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">select</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">select</span><span class="p">(</span><span class="n">measurements</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Select the optimal power limit (W) from measurements.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the optimal power limit (W) from measurements.&quot;&quot;&quot;</span>
    <span class="n">feasible_power_limits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">max_power</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span> <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">)</span>
    <span class="n">shortest_time</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">time</span> <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span> <span class="k">if</span> <span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span> <span class="o">==</span> <span class="n">max_power</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="n">measurements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">measurement</span><span class="o">.</span><span class="n">time</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">*</span> <span class="n">shortest_time</span><span class="p">:</span>
            <span class="n">feasible_power_limits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">power_limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">feasible_power_limits</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.Ready" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Ready</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zeus.utils.pydantic_v1.BaseModel">BaseModel</span></code></p>


        <p>State for when we are ready to start measuring the next power limit.</p>
<p>Initial state of the state machine if no previous profiling results were given.
<code>Ready</code> -&gt; <code>Warmup</code> after <code>step</code>'th <code>on_step_begin</code>.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Ready</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;State for when we are ready to start measuring the next power limit.</span>

<span class="sd">    Initial state of the state machine if no previous profiling results were given.</span>
<span class="sd">    `Ready` -&gt; `Warmup` after `step`&#39;th `on_step_begin`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">next_power_limit</span><span class="p">:</span> <span class="n">PositiveInt</span>
    <span class="n">steps</span><span class="p">:</span> <span class="n">PositiveInt</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.Warmup" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Warmup</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zeus.utils.pydantic_v1.BaseModel">BaseModel</span></code></p>


        <p>State for when we are warming up for a power limit.</p>
<p><code>Warmup</code> -&gt; <code>Profiling</code> on the <code>steps</code>'th <code>on_step_begin</code>.
<code>Warmup</code> -&gt; <code>Ready</code> on <code>on_epoch_end</code> before <code>steps</code>'th <code>on_step_begin</code>.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Warmup</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;State for when we are warming up for a power limit.</span>

<span class="sd">    `Warmup` -&gt; `Profiling` on the `steps`&#39;th `on_step_begin`.</span>
<span class="sd">    `Warmup` -&gt; `Ready` on `on_epoch_end` before `steps`&#39;th `on_step_begin`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">current_power_limit</span><span class="p">:</span> <span class="n">PositiveInt</span>
    <span class="n">steps</span><span class="p">:</span> <span class="n">PositiveInt</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.Profiling" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Profiling</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zeus.utils.pydantic_v1.BaseModel">BaseModel</span></code></p>


        <p>State for when we are profiling a power limit.</p>
<p><code>Profiling</code> -&gt; <code>Warmup</code> after <code>steps</code>'th <code>on_step_begin</code> and
    there are still power limits left to profile.
<code>Profiling</code> -&gt; <code>Done</code> after <code>steps</code>'th <code>on_step_begin</code> and
    there are no more power limits left to profile.
<code>Profiling</code> -&gt; <code>Ready</code> on <code>on_epoch_end</code> before <code>steps</code>'th <code>on_step_begin</code>.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Profiling</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;State for when we are profiling a power limit.</span>

<span class="sd">    `Profiling` -&gt; `Warmup` after `steps`&#39;th `on_step_begin` and</span>
<span class="sd">        there are still power limits left to profile.</span>
<span class="sd">    `Profiling` -&gt; `Done` after `steps`&#39;th `on_step_begin` and</span>
<span class="sd">        there are no more power limits left to profile.</span>
<span class="sd">    `Profiling` -&gt; `Ready` on `on_epoch_end` before `steps`&#39;th `on_step_begin`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">current_power_limit</span><span class="p">:</span> <span class="n">PositiveInt</span>
    <span class="n">steps</span><span class="p">:</span> <span class="n">PositiveInt</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.Done" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Done</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zeus.utils.pydantic_v1.BaseModel">BaseModel</span></code></p>


        <p>State for when we are done profiling all power limits.</p>
<p>Initial state of the state machine if previous profiling results were given.
Final state of the state machine in any case.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Done</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;State for when we are done profiling all power limits.</span>

<span class="sd">    Initial state of the state machine if previous profiling results were given.</span>
<span class="sd">    Final state of the state machine in any case.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">optimal_power_limit</span><span class="p">:</span> <span class="n">PositiveInt</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.PowerLimitMeasurement" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">PowerLimitMeasurement</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zeus.utils.pydantic_v1.BaseModel">BaseModel</span></code></p>


        <p>POD for GPU energy and time measurements for one power limit (W).</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PowerLimitMeasurement</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;POD for GPU energy and time measurements for one power limit (W).&quot;&quot;&quot;</span>

    <span class="n">power_limit</span><span class="p">:</span> <span class="n">PositiveInt</span>  <span class="c1"># In Watts.</span>
    <span class="n">energy</span><span class="p">:</span> <span class="n">PositiveFloat</span>
    <span class="n">time</span><span class="p">:</span> <span class="n">PositiveFloat</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit._PowerLimitMeasurementList" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">_PowerLimitMeasurementList</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="zeus.utils.pydantic_v1.BaseModel">BaseModel</span></code></p>


        <p>Proxy class to save and load a list of <code>PowerLimitMeasurement</code>s.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">_PowerLimitMeasurementList</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Proxy class to save and load a list of `PowerLimitMeasurement`s.&quot;&quot;&quot;</span>

    <span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GlobalPowerLimitOptimizer</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;Callback&lt;/span&gt; (&lt;code&gt;zeus.callback.Callback&lt;/code&gt;)" href="../../callback/#zeus.callback.Callback">Callback</a></code></p>


        <p>Optimizer for the power limit knob.</p>
<p>This optimizer uses the JIT profiling log to determine the optimal power limit.</p>
<h5 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer--usage-with-distributed-data-parallelism">Usage with distributed data parallelism</h5>
<p>The global power limit optimizer expects one process to control each GPU used for training.
For instance, <code>torchrun</code> will automatically spawn one process for each GPU on the node.
Correspondingly, the <a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;ZeusMonitor&lt;/span&gt;" href="../../monitor/energy/#zeus.monitor.energy.ZeusMonitor"><code>ZeusMonitor</code></a> instance passed in
should be monitoring <strong>one GPU</strong>: the one being managed by the current process. The index of
this GPU would typically match the local rank of the process. In the case of PyTorch, users would have
called <code>torch.cuda.set_device</code> early on, so <code>torch.cuda.current_device</code> will give you the GPU index.
<code>GlobalPowerLimitOptimizer</code> will internally do an AllReduce across all GPUs to aggregate
time and energy measurements, and then select the globally optimal power limit.</p>
<div class="highlight"><pre><span></span><code><span class="n">monitor</span> <span class="o">=</span> <span class="n">ZeusMonitor</span><span class="p">(</span><span class="n">gpu_indices</span><span class="o">=</span><span class="p">[</span><span class="n">local_rank</span><span class="p">])</span>  <span class="c1"># pass in local rank to gpu_indices.</span>
<span class="n">plo</span> <span class="o">=</span> <span class="n">GlobalPowerLimitOptimizer</span><span class="p">(</span><span class="n">monitor</span><span class="p">)</span>
</code></pre></div>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GlobalPowerLimitOptimizer</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Optimizer for the power limit knob.</span>

<span class="sd">    This optimizer uses the JIT profiling log to determine the optimal power limit.</span>

<span class="sd">    ## Usage with distributed data parallelism</span>

<span class="sd">    The global power limit optimizer expects one process to control each GPU used for training.</span>
<span class="sd">    For instance, `torchrun` will automatically spawn one process for each GPU on the node.</span>
<span class="sd">    Correspondingly, the [`ZeusMonitor`][zeus.monitor.energy.ZeusMonitor] instance passed in</span>
<span class="sd">    should be monitoring **one GPU**: the one being managed by the current process. The index of</span>
<span class="sd">    this GPU would typically match the local rank of the process. In the case of PyTorch, users would have</span>
<span class="sd">    called `torch.cuda.set_device` early on, so `torch.cuda.current_device` will give you the GPU index.</span>
<span class="sd">    `GlobalPowerLimitOptimizer` will internally do an AllReduce across all GPUs to aggregate</span>
<span class="sd">    time and energy measurements, and then select the globally optimal power limit.</span>


<span class="sd">    ```python</span>
<span class="sd">    monitor = ZeusMonitor(gpu_indices=[local_rank])  # pass in local rank to gpu_indices.</span>
<span class="sd">    plo = GlobalPowerLimitOptimizer(monitor)</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">monitor</span><span class="p">:</span> <span class="n">ZeusMonitor</span><span class="p">,</span>
        <span class="n">optimum_selector</span><span class="p">:</span> <span class="n">OptimumSelector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wait_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">warmup_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">profile_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">pl_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">profile_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize the optimizer.</span>

<span class="sd">        GPU indices to profile and optimize for are taken from `monitor.gpu_indices`.</span>

<span class="sd">        Args:</span>
<span class="sd">            monitor: `ZeusMonitor` instance used to profile GPU time and energy consumption.</span>
<span class="sd">            optimum_selector: The optimum selector to use. If not given, use `ZeusCost` with \eta=0.5.</span>
<span class="sd">            wait_steps: Number of steps to pass by before doing anything at the beginning.</span>
<span class="sd">                Useful if you have something like `torch.backends.cudnn.benchmark=True`,</span>
<span class="sd">                because the first iteration won&#39;t be representative of the rest of the iterations.</span>
<span class="sd">            warmup_steps: Number of warmup iterations for each power limit.</span>
<span class="sd">            profile_steps: Number of profie iterations for each power limit.</span>
<span class="sd">            pl_step: The stride between power limits to explore, in unites of Watts.</span>
<span class="sd">            profile_path: If the path points to an existing file, load the profile from the file</span>
<span class="sd">                and do not run any profiling. If the path points to a non-existing file, profile</span>
<span class="sd">                and save the profile to the file. If `None`, do not save or load any profile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Sanity checks.</span>
        <span class="k">if</span> <span class="n">wait_steps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wait_steps must be non-negative.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">warmup_steps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;warmup_steps must be non-negative.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">profile_steps</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;profile_steps must be positive.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pl_step</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pl_step must be positive.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="n">monitor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum_selector</span> <span class="o">=</span> <span class="n">optimum_selector</span> <span class="ow">or</span> <span class="n">ZeusCost</span><span class="p">(</span>
            <span class="n">eta_knob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">world_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warmup_steps</span> <span class="o">=</span> <span class="n">warmup_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_steps</span> <span class="o">=</span> <span class="n">profile_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pl_step</span> <span class="o">=</span> <span class="n">pl_step</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Internally, we use milliWatts.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">profile_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">profile_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">profile_path</span>

        <span class="n">gpus</span> <span class="o">=</span> <span class="n">get_gpus</span><span class="p">(</span><span class="n">ensure_homogeneous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Warn if distributed training is enabled with multiple GPUs monitored.</span>
        <span class="k">if</span> <span class="n">is_distributed</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Distributed training is enabled with </span><span class="si">%d</span><span class="s2"> GPUs monitored. &quot;</span>
                <span class="s2">&quot;For distributed training, it is recommended to monitor only one GPU per `ZeusMonitor` instance &quot;</span>
                <span class="s2">&quot;since `GlobalPowerLimitOptimizer` performs an all-reduce operation internally over all devices.&quot;</span><span class="p">,</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="c1"># Set the range of power limits to explore.</span>
        <span class="c1"># Assert that supported power limits ranges are uniform across GPUs.</span>
        <span class="n">pls</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">:</span>
            <span class="n">pls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gpus</span><span class="o">.</span><span class="n">get_power_management_limit_constraints</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">pls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">pl</span> <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">pls</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Power limits ranges are not uniform across GPUs.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pl_step</span><span class="p">))</span>

        <span class="c1"># Turn on persistence mode and set to the highest power limit.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">:</span>
                <span class="n">gpus</span><span class="o">.</span><span class="n">set_persistence_mode</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ZeusGPUNoPermissionError</span> <span class="k">as</span> <span class="n">ze</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="s2">&quot;SYS_ADMIN capability is required to modify GPU power limits. See &quot;</span>
                <span class="s2">&quot;https://ml.energy/zeus/getting_started/#system-privileges &quot;</span>
                <span class="s2">&quot;for more information.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ze</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Store `Measurement` objects in a list, one for each power limit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># State for the profiler state machine.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span> <span class="n">Ready</span> <span class="o">|</span> <span class="n">Warmup</span> <span class="o">|</span> <span class="n">Profiling</span> <span class="o">|</span> <span class="n">Done</span>

        <span class="c1"># Initialize JIT profiling states.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JIT profiling enabled.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will wait </span><span class="si">%d</span><span class="s2"> step(s) before profiling.&quot;</span><span class="p">,</span> <span class="n">wait_steps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Ready</span><span class="p">(</span><span class="n">next_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">steps</span><span class="o">=</span><span class="n">wait_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Set power limit to the maximum before starting.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;JIT Profiling enabled. Profile will be saved to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will wait </span><span class="si">%d</span><span class="s2"> step(s) before profiling.&quot;</span><span class="p">,</span> <span class="n">wait_steps</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Ready</span><span class="p">(</span><span class="n">next_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">steps</span><span class="o">=</span><span class="n">wait_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Set power limit to the maximum before starting.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="n">_PowerLimitMeasurementList</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">,</span>
            <span class="p">)</span><span class="o">.</span><span class="n">measurements</span>
            <span class="c1"># self.measurements = _PowerLimitMeasurementList.model_validate_json(</span>
            <span class="c1">#     open(self.profile_path).read(),</span>
            <span class="c1">#     strict=True,</span>
            <span class="c1"># ).measurements</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loaded previous profiling results from &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">))</span>
            <span class="n">optimal_power_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_optimal_power_limit</span><span class="p">()</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Optimal power limit is </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span> <span class="n">optimal_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Done</span><span class="p">(</span><span class="n">optimal_power_limit</span><span class="o">=</span><span class="n">optimal_power_limit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">optimal_power_limit</span><span class="p">)</span>

        <span class="c1"># Restore all GPUs back to their maximum power limit on exit.</span>
        <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the end of a training epoch.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Ready</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="p">(</span><span class="n">Warmup</span><span class="p">,</span> <span class="n">Profiling</span><span class="p">)):</span>
            <span class="c1"># Warmup/Profiling stage interrupted by the end of an epoch.</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> phase for </span><span class="si">%d</span><span class="s2"> W interrupted by the end of a training epoch.&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Profiling</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">end_window</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;__GlobalPowerLimitOptimizer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">cancel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Ready</span><span class="p">(</span><span class="n">next_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Done</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_step_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the beginning of a training step.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Ready</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Starting warmup for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">next_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">next_power_limit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Warmup</span><span class="p">(</span>
                    <span class="n">current_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">next_power_limit</span><span class="p">,</span>
                    <span class="n">steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warmup_steps</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Warmup</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Starting actual profiling for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Profiling</span><span class="p">(</span>
                    <span class="n">current_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="p">,</span>
                    <span class="n">steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_steps</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">begin_window</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;__GlobalPowerLimitOptimizer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Profiling</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">measurement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">end_window</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;__GlobalPowerLimitOptimizer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Finished profiling for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">PowerLimitMeasurement</span><span class="p">(</span>
                        <span class="n">power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
                        <span class="n">energy</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">all_reduce</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">gpu_energy</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)),</span>
                        <span class="n">time</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">all_reduce</span><span class="p">([</span><span class="n">measurement</span><span class="o">.</span><span class="n">time</span><span class="p">],</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">)),</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># If we&#39;re done profiling all power limits, compute the optimal</span>
                <span class="c1"># power limit and transition to the Done state. Otherwise, move</span>
                <span class="c1"># on to the Warmup phase for the next power limit.</span>
                <span class="n">current_power_limit_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">current_power_limit_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Done</span><span class="p">(</span>
                        <span class="n">optimal_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_optimal_power_limit</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">optimal_power_limit</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_save_profile</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">next_power_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">[</span><span class="n">current_power_limit_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Starting warmup for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                        <span class="n">next_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="n">next_power_limit</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Warmup</span><span class="p">(</span>
                        <span class="n">current_power_limit</span><span class="o">=</span><span class="n">next_power_limit</span><span class="p">,</span>
                        <span class="n">steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warmup_steps</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Done</span><span class="p">):</span>
            <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the power limit for all GPUs.</span>

<span class="sd">        Args:</span>
<span class="sd">            power_limit: The power limit to set, in milliWatts.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gpus</span> <span class="o">=</span> <span class="n">get_gpus</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting power limit to </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span> <span class="n">power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">==</span> <span class="n">power_limit</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">:</span>
            <span class="n">gpus</span><span class="o">.</span><span class="n">set_power_management_limit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">power_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">=</span> <span class="n">power_limit</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_optimal_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the optimal power limit in milliWatts.&quot;&quot;&quot;</span>
        <span class="n">optimal_power_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_selector</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Optimal power limit is </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span> <span class="n">optimal_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">optimal_power_limit</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_save_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save JIT profiling results and the optimal power limit to a JSON file.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Done</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="n">_PowerLimitMeasurementList</span><span class="p">(</span><span class="n">measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JIT profiling results saved to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">monitor</span><span class="p">,</span> <span class="n">optimum_selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">warmup_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">profile_steps</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">pl_step</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">profile_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>GPU indices to profile and optimize for are taken from <code>monitor.gpu_indices</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>monitor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;ZeusMonitor&lt;/span&gt; (&lt;code&gt;zeus.monitor.ZeusMonitor&lt;/code&gt;)" href="../../monitor/energy/#zeus.monitor.energy.ZeusMonitor">ZeusMonitor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>ZeusMonitor</code> instance used to profile GPU time and energy consumption.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimum_selector</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;OptimumSelector&lt;/span&gt; (&lt;code&gt;zeus.optimizer.power_limit.OptimumSelector&lt;/code&gt;)" href="#zeus.optimizer.power_limit.OptimumSelector">OptimumSelector</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimum selector to use. If not given, use <code>ZeusCost</code> with \eta=0.5.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps to pass by before doing anything at the beginning.
Useful if you have something like <code>torch.backends.cudnn.benchmark=True</code>,
because the first iteration won't be representative of the rest of the iterations.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warmup_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of warmup iterations for each power limit.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>profile_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of profie iterations for each power limit.</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pl_step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The stride between power limits to explore, in unites of Watts.</p>
              </div>
            </td>
            <td>
                  <code>25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>profile_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the path points to an existing file, load the profile from the file
and do not run any profiling. If the path points to a non-existing file, profile
and save the profile to the file. If <code>None</code>, do not save or load any profile.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">monitor</span><span class="p">:</span> <span class="n">ZeusMonitor</span><span class="p">,</span>
    <span class="n">optimum_selector</span><span class="p">:</span> <span class="n">OptimumSelector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">wait_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">warmup_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">profile_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="n">pl_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">profile_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize the optimizer.</span>

<span class="sd">    GPU indices to profile and optimize for are taken from `monitor.gpu_indices`.</span>

<span class="sd">    Args:</span>
<span class="sd">        monitor: `ZeusMonitor` instance used to profile GPU time and energy consumption.</span>
<span class="sd">        optimum_selector: The optimum selector to use. If not given, use `ZeusCost` with \eta=0.5.</span>
<span class="sd">        wait_steps: Number of steps to pass by before doing anything at the beginning.</span>
<span class="sd">            Useful if you have something like `torch.backends.cudnn.benchmark=True`,</span>
<span class="sd">            because the first iteration won&#39;t be representative of the rest of the iterations.</span>
<span class="sd">        warmup_steps: Number of warmup iterations for each power limit.</span>
<span class="sd">        profile_steps: Number of profie iterations for each power limit.</span>
<span class="sd">        pl_step: The stride between power limits to explore, in unites of Watts.</span>
<span class="sd">        profile_path: If the path points to an existing file, load the profile from the file</span>
<span class="sd">            and do not run any profiling. If the path points to a non-existing file, profile</span>
<span class="sd">            and save the profile to the file. If `None`, do not save or load any profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Sanity checks.</span>
    <span class="k">if</span> <span class="n">wait_steps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wait_steps must be non-negative.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">warmup_steps</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;warmup_steps must be non-negative.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">profile_steps</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;profile_steps must be positive.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pl_step</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;pl_step must be positive.&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span> <span class="o">=</span> <span class="n">monitor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimum_selector</span> <span class="o">=</span> <span class="n">optimum_selector</span> <span class="ow">or</span> <span class="n">ZeusCost</span><span class="p">(</span>
        <span class="n">eta_knob</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">world_size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">warmup_steps</span> <span class="o">=</span> <span class="n">warmup_steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">profile_steps</span> <span class="o">=</span> <span class="n">profile_steps</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pl_step</span> <span class="o">=</span> <span class="n">pl_step</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Internally, we use milliWatts.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">profile_path</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">profile_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">profile_path</span>

    <span class="n">gpus</span> <span class="o">=</span> <span class="n">get_gpus</span><span class="p">(</span><span class="n">ensure_homogeneous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Warn if distributed training is enabled with multiple GPUs monitored.</span>
    <span class="k">if</span> <span class="n">is_distributed</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="s2">&quot;Distributed training is enabled with </span><span class="si">%d</span><span class="s2"> GPUs monitored. &quot;</span>
            <span class="s2">&quot;For distributed training, it is recommended to monitor only one GPU per `ZeusMonitor` instance &quot;</span>
            <span class="s2">&quot;since `GlobalPowerLimitOptimizer` performs an all-reduce operation internally over all devices.&quot;</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="c1"># Set the range of power limits to explore.</span>
    <span class="c1"># Assert that supported power limits ranges are uniform across GPUs.</span>
    <span class="n">pls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">:</span>
        <span class="n">pls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gpus</span><span class="o">.</span><span class="n">get_power_management_limit_constraints</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">pls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">pl</span> <span class="k">for</span> <span class="n">pl</span> <span class="ow">in</span> <span class="n">pls</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Power limits ranges are not uniform across GPUs.&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">pls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">pls</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">pl_step</span><span class="p">))</span>

    <span class="c1"># Turn on persistence mode and set to the highest power limit.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">:</span>
            <span class="n">gpus</span><span class="o">.</span><span class="n">set_persistence_mode</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ZeusGPUNoPermissionError</span> <span class="k">as</span> <span class="n">ze</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="s2">&quot;SYS_ADMIN capability is required to modify GPU power limits. See &quot;</span>
            <span class="s2">&quot;https://ml.energy/zeus/getting_started/#system-privileges &quot;</span>
            <span class="s2">&quot;for more information.&quot;</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">ze</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Store `Measurement` objects in a list, one for each power limit.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">PowerLimitMeasurement</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># State for the profiler state machine.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span> <span class="n">Ready</span> <span class="o">|</span> <span class="n">Warmup</span> <span class="o">|</span> <span class="n">Profiling</span> <span class="o">|</span> <span class="n">Done</span>

    <span class="c1"># Initialize JIT profiling states.</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JIT profiling enabled.&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will wait </span><span class="si">%d</span><span class="s2"> step(s) before profiling.&quot;</span><span class="p">,</span> <span class="n">wait_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Ready</span><span class="p">(</span><span class="n">next_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">steps</span><span class="o">=</span><span class="n">wait_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Set power limit to the maximum before starting.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">))</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;JIT Profiling enabled. Profile will be saved to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Will wait </span><span class="si">%d</span><span class="s2"> step(s) before profiling.&quot;</span><span class="p">,</span> <span class="n">wait_steps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Ready</span><span class="p">(</span><span class="n">next_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">steps</span><span class="o">=</span><span class="n">wait_steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Set power limit to the maximum before starting.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span> <span class="o">=</span> <span class="n">_PowerLimitMeasurementList</span><span class="o">.</span><span class="n">parse_file</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">measurements</span>
        <span class="c1"># self.measurements = _PowerLimitMeasurementList.model_validate_json(</span>
        <span class="c1">#     open(self.profile_path).read(),</span>
        <span class="c1">#     strict=True,</span>
        <span class="c1"># ).measurements</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loaded previous profiling results from &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">))</span>
        <span class="n">optimal_power_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_optimal_power_limit</span><span class="p">()</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Optimal power limit is </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span> <span class="n">optimal_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Done</span><span class="p">(</span><span class="n">optimal_power_limit</span><span class="o">=</span><span class="n">optimal_power_limit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">optimal_power_limit</span><span class="p">)</span>

    <span class="c1"># Restore all GPUs back to their maximum power limit on exit.</span>
    <span class="n">atexit</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.on_epoch_end" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_epoch_end</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">on_epoch_end</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Mark the end of a training epoch.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark the end of a training epoch.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Ready</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="p">(</span><span class="n">Warmup</span><span class="p">,</span> <span class="n">Profiling</span><span class="p">)):</span>
        <span class="c1"># Warmup/Profiling stage interrupted by the end of an epoch.</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> phase for </span><span class="si">%d</span><span class="s2"> W interrupted by the end of a training epoch.&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Profiling</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">end_window</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;__GlobalPowerLimitOptimizer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">cancel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Ready</span><span class="p">(</span><span class="n">next_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">))</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Done</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer.on_step_begin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_step_begin</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">on_step_begin</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Mark the beginning of a training step.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_step_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark the beginning of a training step.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Ready</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Starting warmup for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">next_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">next_power_limit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Warmup</span><span class="p">(</span>
                <span class="n">current_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">next_power_limit</span><span class="p">,</span>
                <span class="n">steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warmup_steps</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Warmup</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Starting actual profiling for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Profiling</span><span class="p">(</span>
                <span class="n">current_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="p">,</span>
                <span class="n">steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_steps</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">begin_window</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;__GlobalPowerLimitOptimizer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Profiling</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">steps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">measurement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">end_window</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;__GlobalPowerLimitOptimizer_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="mi">1000</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;Finished profiling for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">PowerLimitMeasurement</span><span class="p">(</span>
                    <span class="n">power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
                    <span class="n">energy</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">all_reduce</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">measurement</span><span class="o">.</span><span class="n">gpu_energy</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;sum&quot;</span><span class="p">)),</span>
                    <span class="n">time</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">all_reduce</span><span class="p">([</span><span class="n">measurement</span><span class="o">.</span><span class="n">time</span><span class="p">],</span> <span class="n">operation</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">)),</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="c1"># If we&#39;re done profiling all power limits, compute the optimal</span>
            <span class="c1"># power limit and transition to the Done state. Otherwise, move</span>
            <span class="c1"># on to the Warmup phase for the next power limit.</span>
            <span class="n">current_power_limit_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_power_limit</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_power_limit_index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Done</span><span class="p">(</span>
                    <span class="n">optimal_power_limit</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_compute_optimal_power_limit</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">optimal_power_limit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_profile</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">next_power_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">power_limits</span><span class="p">[</span><span class="n">current_power_limit_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Starting warmup for power limit </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span>
                    <span class="n">next_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_power_limit</span><span class="p">(</span><span class="n">next_power_limit</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">Warmup</span><span class="p">(</span>
                    <span class="n">current_power_limit</span><span class="o">=</span><span class="n">next_power_limit</span><span class="p">,</span>
                    <span class="n">steps</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">warmup_steps</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Done</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._set_power_limit" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_set_power_limit</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_set_power_limit</span><span class="p">(</span><span class="n">power_limit</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the power limit for all GPUs.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>power_limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The power limit to set, in milliWatts.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_set_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power_limit</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the power limit for all GPUs.</span>

<span class="sd">    Args:</span>
<span class="sd">        power_limit: The power limit to set, in milliWatts.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gpus</span> <span class="o">=</span> <span class="n">get_gpus</span><span class="p">()</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting power limit to </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span> <span class="n">power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">==</span> <span class="n">power_limit</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">monitor</span><span class="o">.</span><span class="n">gpu_indices</span><span class="p">:</span>
        <span class="n">gpus</span><span class="o">.</span><span class="n">set_power_management_limit</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">power_limit</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_power_limit</span> <span class="o">=</span> <span class="n">power_limit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._compute_optimal_power_limit" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_compute_optimal_power_limit</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_compute_optimal_power_limit</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the optimal power limit in milliWatts.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_compute_optimal_power_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the optimal power limit in milliWatts.&quot;&quot;&quot;</span>
    <span class="n">optimal_power_limit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum_selector</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Optimal power limit is </span><span class="si">%d</span><span class="s2"> W.&quot;</span><span class="p">,</span> <span class="n">optimal_power_limit</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">optimal_power_limit</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.GlobalPowerLimitOptimizer._save_profile" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_save_profile</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_save_profile</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Save JIT profiling results and the optimal power limit to a JSON file.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_save_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save JIT profiling results and the optimal power limit to a JSON file.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">Done</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="n">_PowerLimitMeasurementList</span><span class="p">(</span><span class="n">measurements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">measurements</span><span class="p">)</span><span class="o">.</span><span class="n">json</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;JIT profiling results saved to &#39;</span><span class="si">%s</span><span class="s2">&#39;.&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">HFGlobalPowerLimitOptimizer</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="transformers.trainer_callback.TrainerCallback">TrainerCallback</span></code></p>


        <p>[Wrapped for Hugging Face Trainer Callback] Optimizer for the power limit knob.</p>
<p>This optimizer uses the JIT profiling log to determine the optimal power limit.
See <a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;GlobalPowerLimitOptimizer&lt;/span&gt;" href="#zeus.optimizer.power_limit.GlobalPowerLimitOptimizer"><code>GlobalPowerLimitOptimizer</code></a>
for the underlying optimizer implementation.</p>








              <details class="quote">
                <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">HFGlobalPowerLimitOptimizer</span><span class="p">(</span><span class="n">TrainerCallback</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;[Wrapped for Hugging Face Trainer Callback] Optimizer for the power limit knob.</span>

<span class="sd">    This optimizer uses the JIT profiling log to determine the optimal power limit.</span>
<span class="sd">    See [`GlobalPowerLimitOptimizer`][zeus.optimizer.power_limit.GlobalPowerLimitOptimizer]</span>
<span class="sd">    for the underlying optimizer implementation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">monitor</span><span class="p">:</span> <span class="n">ZeusMonitor</span><span class="p">,</span>
        <span class="n">optimum_selector</span><span class="p">:</span> <span class="n">OptimumSelector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">wait_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">warmup_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">profile_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">pl_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">profile_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize the optimizer.</span>

<span class="sd">        GPU indices to profile and optimize for are taken from `monitor.gpu_indices`.</span>

<span class="sd">        Args:</span>
<span class="sd">            monitor: `ZeusMonitor` instance used to profile GPU time and energy consumption.</span>
<span class="sd">            optimum_selector: The optimum selector to use. If not given, use `ZeusCost` with \eta=0.5.</span>
<span class="sd">            wait_steps: Number of steps to pass by before doing anything at the beginning.</span>
<span class="sd">                Useful if you have something like `torch.backends.cudnn.benchmark=True`,</span>
<span class="sd">                because the first iteration won&#39;t be representative of the rest of the iterations.</span>
<span class="sd">            warmup_steps: Number of warmup iterations for each power limit.</span>
<span class="sd">            profile_steps: Number of profie iterations for each power limit.</span>
<span class="sd">            pl_step: The stride between power limits to explore, in unites of Watts.</span>
<span class="sd">            profile_path: If the path points to an existing file, load the profile from the file</span>
<span class="sd">                and do not run any profiling. If the path points to a non-existing file, profile</span>
<span class="sd">                and save the profile to the file. If `None`, do not save or load any profile.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">transformers_available</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;The transformers package is not installed. Please install it to use the HFGlobalPowerLimitOptimizer.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">GlobalPowerLimitOptimizer</span><span class="p">(</span>
            <span class="n">monitor</span><span class="o">=</span><span class="n">monitor</span><span class="p">,</span>
            <span class="n">optimum_selector</span><span class="o">=</span><span class="n">optimum_selector</span><span class="p">,</span>
            <span class="n">wait_steps</span><span class="o">=</span><span class="n">wait_steps</span><span class="p">,</span>
            <span class="n">warmup_steps</span><span class="o">=</span><span class="n">warmup_steps</span><span class="p">,</span>
            <span class="n">profile_steps</span><span class="o">=</span><span class="n">profile_steps</span><span class="p">,</span>
            <span class="n">pl_step</span><span class="o">=</span><span class="n">pl_step</span><span class="p">,</span>
            <span class="n">profile_path</span><span class="o">=</span><span class="n">profile_path</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">TrainingArguments</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">TrainerState</span><span class="p">,</span>
        <span class="n">control</span><span class="p">:</span> <span class="n">TrainerControl</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the end of a training epoch.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">on_epoch_end</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">on_step_begin</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="n">TrainingArguments</span><span class="p">,</span>
        <span class="n">state</span><span class="p">:</span> <span class="n">TrainerState</span><span class="p">,</span>
        <span class="n">control</span><span class="p">:</span> <span class="n">TrainerControl</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the beginning of a training step.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">on_step_begin</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">(</span><span class="n">monitor</span><span class="p">,</span> <span class="n">optimum_selector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wait_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">warmup_steps</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">profile_steps</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">pl_step</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">profile_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>GPU indices to profile and optimize for are taken from <code>monitor.gpu_indices</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>monitor</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;ZeusMonitor&lt;/span&gt; (&lt;code&gt;zeus.monitor.ZeusMonitor&lt;/code&gt;)" href="../../monitor/energy/#zeus.monitor.energy.ZeusMonitor">ZeusMonitor</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>ZeusMonitor</code> instance used to profile GPU time and energy consumption.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimum_selector</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="&lt;span class=&quot;doc doc-object-name doc-class-name&quot;&gt;OptimumSelector&lt;/span&gt; (&lt;code&gt;zeus.optimizer.power_limit.OptimumSelector&lt;/code&gt;)" href="#zeus.optimizer.power_limit.OptimumSelector">OptimumSelector</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimum selector to use. If not given, use <code>ZeusCost</code> with \eta=0.5.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wait_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of steps to pass by before doing anything at the beginning.
Useful if you have something like <code>torch.backends.cudnn.benchmark=True</code>,
because the first iteration won't be representative of the rest of the iterations.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warmup_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of warmup iterations for each power limit.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>profile_steps</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of profie iterations for each power limit.</p>
              </div>
            </td>
            <td>
                  <code>40</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pl_step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The stride between power limits to explore, in unites of Watts.</p>
              </div>
            </td>
            <td>
                  <code>25</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>profile_path</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the path points to an existing file, load the profile from the file
and do not run any profiling. If the path points to a non-existing file, profile
and save the profile to the file. If <code>None</code>, do not save or load any profile.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">monitor</span><span class="p">:</span> <span class="n">ZeusMonitor</span><span class="p">,</span>
    <span class="n">optimum_selector</span><span class="p">:</span> <span class="n">OptimumSelector</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">wait_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">warmup_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">profile_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="n">pl_step</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">profile_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Initialize the optimizer.</span>

<span class="sd">    GPU indices to profile and optimize for are taken from `monitor.gpu_indices`.</span>

<span class="sd">    Args:</span>
<span class="sd">        monitor: `ZeusMonitor` instance used to profile GPU time and energy consumption.</span>
<span class="sd">        optimum_selector: The optimum selector to use. If not given, use `ZeusCost` with \eta=0.5.</span>
<span class="sd">        wait_steps: Number of steps to pass by before doing anything at the beginning.</span>
<span class="sd">            Useful if you have something like `torch.backends.cudnn.benchmark=True`,</span>
<span class="sd">            because the first iteration won&#39;t be representative of the rest of the iterations.</span>
<span class="sd">        warmup_steps: Number of warmup iterations for each power limit.</span>
<span class="sd">        profile_steps: Number of profie iterations for each power limit.</span>
<span class="sd">        pl_step: The stride between power limits to explore, in unites of Watts.</span>
<span class="sd">        profile_path: If the path points to an existing file, load the profile from the file</span>
<span class="sd">            and do not run any profiling. If the path points to a non-existing file, profile</span>
<span class="sd">            and save the profile to the file. If `None`, do not save or load any profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">transformers_available</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
            <span class="s2">&quot;The transformers package is not installed. Please install it to use the HFGlobalPowerLimitOptimizer.&quot;</span>
        <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">GlobalPowerLimitOptimizer</span><span class="p">(</span>
        <span class="n">monitor</span><span class="o">=</span><span class="n">monitor</span><span class="p">,</span>
        <span class="n">optimum_selector</span><span class="o">=</span><span class="n">optimum_selector</span><span class="p">,</span>
        <span class="n">wait_steps</span><span class="o">=</span><span class="n">wait_steps</span><span class="p">,</span>
        <span class="n">warmup_steps</span><span class="o">=</span><span class="n">warmup_steps</span><span class="p">,</span>
        <span class="n">profile_steps</span><span class="o">=</span><span class="n">profile_steps</span><span class="p">,</span>
        <span class="n">pl_step</span><span class="o">=</span><span class="n">pl_step</span><span class="p">,</span>
        <span class="n">profile_path</span><span class="o">=</span><span class="n">profile_path</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.on_epoch_end" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_epoch_end</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">on_epoch_end</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Mark the end of a training epoch.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_epoch_end</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">TrainingArguments</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">TrainerState</span><span class="p">,</span>
    <span class="n">control</span><span class="p">:</span> <span class="n">TrainerControl</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark the end of a training epoch.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">on_epoch_end</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="zeus.optimizer.power_limit.HFGlobalPowerLimitOptimizer.on_step_begin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">on_step_begin</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">on_step_begin</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Mark the beginning of a training step.</p>


            <details class="quote">
              <summary>Source code in <code>zeus/optimizer/power_limit.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">on_step_begin</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">TrainingArguments</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">TrainerState</span><span class="p">,</span>
    <span class="n">control</span><span class="p">:</span> <span class="n">TrainerControl</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark the beginning of a training step.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">on_step_begin</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
  



  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 Zeus team
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://github.com/ml-energy/zeus" target="_blank" rel="noopener" title="Zeus GitHub repository" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://hub.docker.com/r/mlenergy/zeus" target="_blank" rel="noopener" title="Zeus Docker Hub registry" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://join.slack.com/t/zeus-ml/shared_invite/zt-36fl1m7qa-Ihky6FbfxLtobx40hMj3VA" target="_blank" rel="noopener" title="Zeus Slack workspace" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "search.suggest", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "content.tooltips", "announce.dismiss"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.dd8806f2.min.js"></script>
      
        <script src="../../../assets/js/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>